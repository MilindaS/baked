/*
 * CutJS 0.2.1
 * Copyright (c) 2013-2014 Ali Shakiba, Piqnt LLC and other contributors
 * Available under the MIT license
 * @license
 */
function Cut(){if(!(this instanceof Cut)){if("function"==typeof arguments[0])return Cut.Loader.load.apply(Cut.Loader,arguments);if("object"==typeof arguments[0])return Cut.Texture.add.apply(Cut.Texture,arguments)}Cut._stats.create++,this._id="",this._visible=!0,this._parent=null,this._next=null,this._prev=null,this._first=null,this._last=null,this._pin=new Cut.Pin(this),this._cutouts=[],this._tickBefore=[],this._tickAfter=[],this._alpha=1}DEBUG=("undefined"==typeof DEBUG||DEBUG)&&console,Cut._create=function(){if("function"==typeof Object.create)return function(){return Object.create.apply(null,arguments)};var t=function(){};return function(i){if(arguments.length>1)throw Error("Second argument is not supported!");if(null===i||"object"!=typeof i)throw Error("Invalid prototype!");return t.prototype=i,new t}}(),Cut._stats={create:0,tick:0,paint:0,paste:0},Cut.create=function(){return new Cut},Cut.prototype.render=function(t){Cut._stats.tick=Cut._stats.paint=Cut._stats.paste=0;var i=Cut._now(),e=this._lastTime?i-this._lastTime:0;this._lastTime=i,this._tick(e),this._paint(t),Cut._stats.fps=1e3/(Cut._now()-i)},Cut.prototype.MAX_ELAPSE=1/0,Cut.prototype._tick=function(t){if(this._visible){t>this.MAX_ELAPSE&&(t=this.MAX_ELAPSE),this._pin.tick();for(var i=this._tickBefore.length,e=0;i>e;e++)Cut._stats.tick++,this._tickBefore[e].call(this,t);for(var n,s=this._first;n=s;)s=n._next,n._tick(t);for(var i=this._tickAfter.length,e=0;i>e;e++)Cut._stats.tick++,this._tickAfter[e].call(this,t)}},Cut.prototype.tick=function(t,i){i?this._tickBefore.push(t):this._tickAfter.push(t)},Cut.prototype.untick=function(t){var i;t&&((i=this._tickBefore.indexOf(t))>=0?this._tickBefore.splice(i,1):(i=this._tickAfter.indexOf(t))>=0&&this._tickAfter.splice(i,1))},Cut.prototype._paint=function(t){if(this._visible){Cut._stats.paint++;var i=this._pin.absoluteMatrix();t.setTransform(i.a,i.b,i.c,i.d,i.e,i.f),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var e=this._pin._textureAlpha*this._alpha;t.globalAlpha!=e&&(t.globalAlpha=e);for(var n=this._cutouts.length,s=0;n>s;s++)this._cutouts[s].paste(t);t.globalAlpha!=this._alpha&&(t.globalAlpha=this._alpha);for(var r,o=this._first;r=o;)o=r._next,r._paint(t)}},Cut.prototype.toString=function(){return"["+this._id+"]"},Cut.prototype.id=function(t){return"undefined"==typeof t?this._id:(this._id=t,this)},Cut.prototype.attr=function(t,i){return"undefined"==typeof i?this._attrs?this._attrs[t]:void 0:((this._attrs?this._attrs:this._attrs={})[t]=i,this)},Cut.prototype.on=Cut.prototype.listen=function(t,i){if("function"!=typeof i)return this;t=(Cut._isArray(t)?t.join(" "):t).split(/\s+/);for(var e=0;e<t.length;e++){var n=t[e];n&&(this._listeners=this._listeners||{},this._listeners[n]=this._listeners[n]||[],this._listeners[n].push(i),this._listenOn(n))}return this},Cut.prototype.listeners=function(t){return this._listeners&&this._listeners[t]},Cut.prototype.publish=function(t,i){var e=this.listeners(t);if(!e||!e.length)return 0;for(var n=0;n<e.length;n++)e[n].apply(this,i);return e.length},Cut.prototype.trigger=function(t,i){return this.publish(t,i),this},Cut.prototype.visit=function(t){var i=t.reverse,e=t.visible;if(!t.start||!t.start(this)){for(var n,s=i?this.last(e):this.first(e);n=s;)if(s=i?n.prev(e):n.next(e),n.visit(t,i))return!0;return t.end&&t.end(this)}},Cut.prototype.visible=function(t){return"undefined"==typeof t?this._visible:(this._visible=t,this._parent&&(this._parent._ts_children=Cut._TS++),this._ts_pin=Cut._TS++,this.touch(),this)},Cut.prototype.hide=function(){return this.visible(!1)},Cut.prototype.show=function(){return this.visible(!0)},Cut.prototype.parent=function(){return this._parent},Cut.prototype.next=function(t){for(var i=this._next;i&&t&&!i._visible;)i=i._next;return i},Cut.prototype.prev=function(t){for(var i=this._prev;i&&t&&!i._visible;)i=i._prev;return i},Cut.prototype.first=function(t){for(var i=this._first;i&&t&&!i._visible;)i=i._next;return i},Cut.prototype.last=function(t){for(var i=this._last;i&&t&&!i._visible;)i=i._prev;return i},Cut.prototype.append=function(){for(var t=0;t<arguments.length;t++){if(!Cut._isCut(arguments[t]))throw"It is not a Cut node!";arguments[t].appendTo(this)}return this},Cut.prototype.prepend=function(){for(var t=0;t<arguments.length;t++){if(!Cut._isCut(arguments[t]))throw"It is not a Cut node!";arguments[t].prependTo(this)}return this},Cut.prototype.appendTo=function(t){if(!t)throw"Parent is null!";if(!Cut._isCut(t))throw"It is not a Cut node!";return this.remove(),t._last&&(t._last._next=this,this._prev=t._last),this._parent=t,t._last=this,t._first||(t._first=this),this._parent._listenOn(this),this._ts_parent=Cut._TS++,t._ts_children=Cut._TS++,t.touch(),this},Cut.prototype.prependTo=function(t){if(!t)throw"Parent is null!";if(!Cut._isCut(t))throw"It is not a Cut node!";return this.remove(),t._first&&(t._first._prev=this,this._next=t._first),this._parent=t,t._first=this,t._last||(t._last=this),this._parent._listenOn(this),this._ts_parent=Cut._TS++,t._ts_children=Cut._TS++,t.touch(),this},Cut.prototype.insertNext=function(){if(arguments.length)for(var t=0;t<arguments.length;t++){if(!Cut._isCut(arguments[t]))throw"It is not a Cut node!";arguments[t]&&arguments[t].insertAfter(this)}return this},Cut.prototype.insertPrev=function(){if(arguments.length)for(var t=0;t<arguments.length;t++){if(!Cut._isCut(arguments[t]))throw"It is not a Cut node!";arguments[t]&&arguments[t].insertBefore(this)}return this},Cut.prototype.insertBefore=function(t){if(!t)throw"Next is null!";if(!Cut._isCut(t))throw"It is not a Cut node!";this.remove();var i=t._parent,e=t._prev;return t._prev=this,e&&(e._next=this)||i&&(i._first=this),this._parent=i,this._prev=e,this._next=t,this._parent._listenOn(this),this._ts_parent=Cut._TS++,this.touch(),this},Cut.prototype.insertAfter=function(t){if(!t)throw"Prev is null!";if(!Cut._isCut(t))throw"It is not a Cut node!";this.remove();var i=t._parent,e=t._next;return t._next=this,e&&(e._prev=this)||i&&(i._last=this),this._parent=i,this._prev=t,this._next=e,this._parent._listenOn(this),this._ts_parent=Cut._TS++,this.touch(),this},Cut.prototype.remove=function(){if(arguments.length){for(var t=0;t<arguments.length;t++){if(!Cut._isCut(arguments[t]))throw"It is not a Cut node!";arguments[t]&&arguments[t].remove()}return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev),this._parent._listenOff(this),this._parent._ts_children=Cut._TS++,this._parent.touch()),this._prev=this._next=this._parent=null,this._ts_parent=Cut._TS++,this},Cut.prototype.empty=function(){for(var t,i=this._first;t=i;)i=t._next,t._prev=t._next=t._parent=null,this._listenOff(t);return this._first=this._last=null,this._ts_children=Cut._TS++,this.touch(),this},Cut.prototype._listenOn=function(t){if("string"==typeof t)this._listenersCount=this._listenersCount||{},!this._listenersCount[t]&&this._parent&&this._parent._listenOn(t),this._listenersCount[t]=(this._listenersCount[t]||0)+1;else if("object"==typeof t&&t._listenersCount)for(var i in t._listenersCount)t._listenersCount[i]>0&&this._listenOn(i)},Cut.prototype._listenOff=function(t){if("string"==typeof t)this._listenersCount=this._listenersCount||{},1==this._listenersCount[t]&&this._parent&&this._parent._listenOff(t),this._listenersCount[t]=Math.max((this._listenersCount[t]||0)-1,0);else if("object"==typeof t&&t._listenersCount)for(var i in t._listenersCount)t._listenersCount[i]>0&&this._listenOff(i)},Cut.prototype._listens=function(t){return this._listenersCount&&this._listenersCount[t]||0},Cut.prototype.touch=function(){return this._ts_touch=Cut._TS++,this._parent&&this._parent.touch(),this},Cut.prototype.pin=function(t,i){return"object"==typeof t?(this._pin.set(t),this):"string"==typeof t?"undefined"==typeof i?this._pin.get(t):(this._pin.set(t,i),this):"undefined"==typeof t?this._pin:void 0},Cut.prototype.matrix=function(){return this._pin.absoluteMatrix(this,this._parent?this._parent._pin:null)},Cut.prototype.tween=function(t,i){return(this._tween||(this._tween=new Cut.Tween(this))).tween(t,i)},Cut.Tween=function(t){var i=this;this._owner=t,this._queue=[],this._next=null,t.tick(function(e){if(i._queue.length){this.touch();var n=i._queue[0];if(n.time?n.time+=e:n.time=1,!(n.time<n.delay)){if(!n.start){n.start={},n.keys={};for(var s in n.end)"number"==typeof(start=t.pin(s))?(n.start[s]=start,n.keys[s]=s):"number"==typeof(startX=t.pin(s+"X"))&&"number"==typeof(startY=t.pin(s+"Y"))&&(n.start[s+"X"]=startX,n.keys[s+"X"]=s,n.start[s+"Y"]=startY,n.keys[s+"Y"]=s)}var r=(n.time-n.delay)/n.duration,o=r>=1;r=r>1?1:r,r="function"==typeof n.easing?n.easing(r):r;var u=1-r;for(var s in n.keys)t.pin(s,n.start[s]*u+n.end[n.keys[s]]*r);o&&(i._queue.shift(),n.then&&n.then.call(t))}}},!0)},Cut.Tween.prototype.tween=function(t,i){return this._next={id:Cut._TS++,end:{},duration:t||400,delay:i||0},this},Cut.Tween.prototype.pin=function(){this._next!==this._queue[this._queue.length-1]&&(this._owner.touch(),this._queue.push(this._next));var t=this._next.end;return 1===arguments.length?Cut._extend(t,arguments[0]):2===arguments.length&&(t[arguments[0]]=arguments[1]),this},Cut.Tween.prototype.clear=function(t){for(var i;i=this._queue.shift();)t&&this._owner.pin(i.end);return this},Cut.Tween.prototype.then=function(t){return this._next.then=t,this},Cut.Tween.prototype.ease=function(t){return this._next.easing=Cut.Easing(t),this},Cut.root=function(t,i){return new Cut.Root(t,i)},Cut.Root=function(t,i){Cut.Root.prototype._super.apply(this,arguments),this._paused=!0,this._render=i;var e=this,n=function(){e._paused!==!0&&(e._mo_touch=e._ts_touch,e._render(),e.request(),e._mo_touch==e._ts_touch&&e.pause())};this.request=function(){t(n)},this.on("viewport",function(t){return this._size={width:t.width,height:t.height},this._updateViewbox(),!0})},Cut.Root.prototype=Cut._create(Cut.prototype),Cut.Root.prototype._super=Cut,Cut.Root.prototype.constructor=Cut.Root,Cut.Root.prototype.viewbox=function(t,i,e){return this._viewbox={width:t,height:i,mode:/^(in|out)$/.test(e)?e:"in"},this._updateViewbox(),this},Cut.Root.prototype._updateViewbox=function(){var t=this._viewbox,i=this._size;i&&this.pin(t?{width:t.width,height:t.height,resizeMode:t.mode,resizeWidth:i.width,resizeHeight:i.height}:{width:i.width,height:i.height})},Cut.Root.prototype.start=function(){return this.resume()},Cut.Root.prototype.resume=function(t){return(this._paused||t)&&(this._paused=!1,this.request()),this},Cut.Root.prototype.pause=function(){return this._paused=!0,this},Cut.Root.prototype.touch=function(){return this.resume(),Cut.prototype.touch.call(this)},Cut.Root.prototype.resize=function(t,i,e){this._ratio=e||1;var n={};return n.width=t,n.height=i,n.ratio=e,this.visit({start:function(t){return t._listens("viewport")?void t.publish("viewport",[n]):!0}}),this},Cut.image=function(t){var i=new Cut.Image;return t&&i.image(t),i},Cut.Image=function(){Cut.Image.prototype._super.apply(this,arguments)},Cut.Image.prototype=Cut._create(Cut.prototype),Cut.Image.prototype._super=Cut,Cut.Image.prototype.constructor=Cut.Image,Cut.Image.prototype.setImage=function(t,i,e){return this.image(t,i,e)},Cut.Image.prototype.image=function(t){return this._cutouts[0]=Cut.Out.select(t),this._cutouts.length=1,this.pin({width:this._cutouts[0]?this._cutouts[0].dWidth():0,height:this._cutouts[0]?this._cutouts[0].dHeight():0}),this._cutout=this._cutouts[0].clone(),this},Cut.Image.prototype.cropX=function(t,i){return this.image(this._cutouts[0].cropX(t,i))},Cut.Image.prototype.cropY=function(t,i){return this.image(this._cutouts[0].cropY(t,i))},Cut.Image.prototype._slice=function(t){return this._cutouts[t]||(this._cutouts[t]=this._cutout.clone())},Cut.Image.prototype.tile=function(t){return this.untick(this._repeatTicker),this._repeatTicker=function(){if(this._mo_tile!=this._ts_touch){this._mo_tile=this._ts_touch;var i=this._cutout._left,e=this._cutout._right,n=this._cutout._top,s=this._cutout._bottom,r=this._cutout.dWidth()-i-e,o=this._cutout.dHeight()-n-s,u=this.pin("width");u=t?u:u-i-e;var h=this.pin("height");h=t?h:h-n-s;var a=t?-i:0,_=t?-n:0,c=0;n&&i&&this._slice(c++).cropX(i,0).cropY(n,0).offset(a,_),s&&i&&this._slice(c++).cropX(i,0).cropY(s,o+n).offset(a,_+h+n),n&&e&&this._slice(c++).cropX(e,r+i).cropY(n,0).offset(a+u+i,_),s&&e&&this._slice(c++).cropX(e,r+i).cropY(s,o+n).offset(a+u+i,_+h+n);for(var f=a+i,p=u;p>0;){var l=Math.min(r,p);p-=r;for(var d=_+n,g=h;g>0;){var C=Math.min(o,g);g-=o,this._slice(c++).cropX(l,i).cropY(C,n).offset(f,d),0>=p&&(i&&this._slice(c++).cropX(i,0).cropY(C,n).offset(a,d),e&&this._slice(c++).cropX(e,r+i).cropY(C,n).offset(f+l,d)),d+=C}n&&this._slice(c++).cropX(l,i).cropY(n,0).offset(f,_),s&&this._slice(c++).cropX(l,i).cropY(s,o+n).offset(f,d),f+=l}this._cutouts.length=c}},this.tick(this._repeatTicker),this},Cut.Image.prototype.stretch=function(t){return this.untick(this._repeatTicker),this._repeatTicker=function(){if(this._mo_stretch!=this._pin._ts_transform){this._mo_stretch=this._pin._ts_transform;var i=this._cutout._left,e=this._cutout._right,n=this._cutout._top,s=this._cutout._bottom,r=this._cutout.dWidth(),o=this._cutout.dHeight(),u=this.pin("width"),h=this.pin("height");u=t?u+i+e:Math.max(u,i+e),h=t?h+n+s:Math.max(h,n+s);var a=0;n&&i&&this._slice(a++).cropX(i,0).cropY(n,0).offset(0,0),s&&i&&this._slice(a++).cropX(i,0).cropY(s,o-s).offset(0,h-s),n&&e&&this._slice(a++).cropX(e,r-e).cropY(n,0).offset(u-e,0),s&&e&&this._slice(a++).cropX(e,r-e).cropY(s,o-s).offset(u-e,h-s),n&&this._slice(a++).cropX(r-i-e,i).cropY(n,0).offset(i,0).dWidth(u-i-e),s&&this._slice(a++).cropX(r-i-e,i).cropY(s,o-s).offset(i,h-s).dWidth(u-i-e),i&&this._slice(a++).cropX(i,0).cropY(o-n-s,n).offset(0,n).dHeight(h-n-s),e&&this._slice(a++).cropX(e,r-e).cropY(o-n-s,n).offset(u-e,n).dHeight(h-n-s),this._slice(a++).cropX(r-i-e,i).cropY(o-n-s,n).offset(i,n).dWidth(u-i-e).dHeight(h-n-s),this._cutouts.length=a}},this.tick(this._repeatTicker),this},Cut.anim=function(t,i){var e=(new Cut.Anim).frames(t).gotoFrame(0);return i&&e.fps(i),e},Cut.Anim=function(){Cut.Anim.prototype._super.apply(this,arguments),this._fps=Cut.Anim.FPS,this._ft=1e3/this._fps,this._time=0,this._frame=0,this._frames=[],this._labels={},this.tick(function(){if(this._time&&this._frames.length>1){var t=Cut._now()-this._time;if(t>=this._ft){var i=t<2*this._ft?1:Math.floor(t/this._ft);this._time+=i*this._ft,this.moveFrame(i),this._repeat&&(this._repeat-=i)<=0&&(this.stop(),this._callback&&this._callback())}this.touch()}},!1)},Cut.Anim.prototype=Cut._create(Cut.prototype),Cut.Anim.prototype._super=Cut,Cut.Anim.prototype.constructor=Cut.Anim,Cut.Anim.FPS=22,Cut.Anim.prototype.fps=function(t){return"undefined"==typeof t?this._fps:(this._fps=t||Cut.Anim.FPS,this._ft=1e3/this._fps,this)},Cut.Anim.prototype.setFrames=function(t,i,e){return this.frames(t,i,e)},Cut.Anim.prototype.frames=function(t){if(this._time=this._time||0,this._frame=0,this._frames=[],this._labels={},t=Cut.Out.select(t,!0),t&&t.length)for(var i=0;i<t.length;i++){var e=t[i];this._frames.push(e),this._labels[e._name]=i}return this},Cut.Anim.prototype.length=function(){return this._frames?this._frames.length:0},Cut.Anim.prototype.gotoFrame=function(t,i){return t=0|Cut.Math.rotate(t,this._frames.length),this._frame=t,i=i||!this._cutouts[0],this._cutouts[0]=this._frames[this._frame],i&&this.pin({width:this._cutouts[0].dWidth(),height:this._cutouts[0].dHeight()}),this._ts_frame=Cut._TS++,this.touch(),this},Cut.Anim.prototype.moveFrame=function(t){return this.gotoFrame(this._frame+t)},Cut.Anim.prototype.gotoLabel=function(t,i){return this.gotoFrame(this._labels[t]||0,i)},Cut.Anim.prototype.repeat=function(t,i){return this._repeat=t*this._frames.length-1,this._callback=i,this.play(),this},Cut.Anim.prototype.play=function(t){return"undefined"!=typeof t?(this.gotoFrame(t),this._time=Cut._now()):this._time||(this._time=Cut._now()),this},Cut.Anim.prototype.stop=function(t){return this._time=null,"undefined"!=typeof t&&this.gotoFrame(t),this},Cut.string=function(t){return(new Cut.String).frames(t)},Cut.String=function(){Cut.String.prototype._super.apply(this,arguments),this.row()},Cut.String.prototype=Cut._create(Cut.prototype),Cut.String.prototype._super=Cut,Cut.String.prototype.constructor=Cut.String,Cut.String.prototype.setFont=function(t,i,e){return this.frames(t,i,e)},Cut.String.prototype.frames=function(t){return"string"==typeof t?this._frames=function(i){return t+i}:Cut._isFunc(t)&&(this._frames=t),this},Cut.String.prototype.setValue=function(t,i,e){return this.value(t,i,e)},Cut.String.prototype.value=function(t){if(this._value===t)return this;this._value=t,"string"==typeof t||Cut._isArray(t)||(t+="");for(var i=this._first,e=0;e<t.length;e++){var n=this._frames(t[e]);i?i.image(n).show():i=Cut.image(n).appendTo(this),i=i._next}for(;i;)i.hide(),i=i._next;return this},Cut.row=function(t){return Cut.create().row(t)},Cut.prototype.row=function(t){return this.sequence("row",t),this},Cut.column=function(t){return Cut.create().column(t)},Cut.prototype.column=function(t){return this.sequence("column",t),this},Cut.sequence=function(t,i){return(new Cut.create).sequence(t,i)},Cut.prototype.sequence=function(t,i){return this.untick(this._layoutTicker),this._layoutTicker=function(){if(this._mo_seq!=this._ts_touch){this._mo_seq=this._ts_touch;var e=this._mo_seqAlign!=this._ts_children;this._mo_seqAlign=this._ts_children;for(var n,s=0,r=0,o=this.first(!0),u=!0;n=o;){o=n.next(!0),n._pin.relativeMatrix();var h=n._pin._boxWidth,a=n._pin._boxHeight;"column"==t?(!u&&(r+=this._spacing||0),n.pin("offsetY")!=r&&n.pin("offsetY",r),s=Math.max(s,h),r+=a,e&&n.pin("alignX",i)):"row"==t&&(!u&&(s+=this._spacing||0),n.pin("offsetX")!=s&&n.pin("offsetX",s),s+=h,r=Math.max(r,a),e&&n.pin("alignY",i)),u=!1}s+=2*this._padding||0,r+=2*this._padding||0,this.pin("width")!=s&&this.pin("width",s),this.pin("height")!=r&&this.pin("height",r)}},this.tick(this._layoutTicker),this},Cut.box=function(){return(new Cut.create).box()},Cut.prototype.box=function(){return this._boxTicker?this:(this._boxTicker=function(){if(this._mo_box!=this._ts_touch){this._mo_box=this._ts_touch;for(var t,i=0,e=0,n=this.first(!0);t=n;){n=t.next(!0),t._pin.relativeMatrix();var s=t._pin._boxWidth,r=t._pin._boxHeight;i=Math.max(i,s),e=Math.max(e,r)}i+=2*this._padding||0,e+=2*this._padding||0,this.pin("width")!=i&&this.pin("width",i),this.pin("height")!=e&&this.pin("height",e)}},this.tick(this._boxTicker),this)},Cut.prototype.padding=function(t){return this._padding=t,this},Cut.prototype.spacing=function(t){return this._spacing=t,this},Cut.Loader=function(){function t(t,i){function e(){DEBUG&&console.log("Image loaded."),s()}function n(t){DEBUG&&console.log("Error loading image: "+t),s()}function s(){--r<=0&&i&&i()}var r=0,o=!0,u=Cut.Texture._list;for(var h in u)if(u[h].getImagePath()){r++;var a=u[h].getImagePath(),_=t(a,e,n);Cut.Loader.addImage(_,a),o=!1}o&&(DEBUG&&console.log("No image to load."),i&&i())}var i=[],e=[],n={},s=!1;return{load:function(n,r){if(!s)return void i.push(arguments);DEBUG&&console.log("Init...");var o=this.init(function(t,i){DEBUG&&console.log("Loading app..."),n(t,i)},r);e.push(o),DEBUG&&console.log("Loading images..."),t(this.loadImage,function(){DEBUG&&console.log("Images loaded."),DEBUG&&console.log("Start playing..."),o.start()})},start:function(){s=!0;for(var t;t=i.shift();)this.load.apply(this,t)},pause:function(){for(var t=i.length-1;t>=0;t--)e[t].pause()},resume:function(){for(var t=i.length-1;t>=0;t--)e[t].resume()},getImage:function(t){return n[t]},addImage:function(t,i){return n[i]=t,this}}}(),Cut.Texture=function(t){function i(){return r||(r=Cut.Loader.getImage(t.imagePath)),r}function e(i){if(!i||i.isCutout)return i;"function"==typeof t.map?i=t.map(i):"function"==typeof t.filter&&(i=t.filter(i));var e=t.ratio||1;1!=e&&(i.x*=e,i.y*=e,i.width*=e,i.height*=e,i.top*=e,i.bottom*=e,i.left*=e,i.right*=e);var n=t.trim||0;return n&&(i.x+=n,i.y+=n,i.width-=2*n,i.height-=2*n,i.top-=n,i.bottom-=n,i.left-=n,i.right-=n),i}function n(e){return e.isCutout||(e=new Cut.Out(e,i,t.imageRatio)),e}t.cutouts=t.cutouts||[];var s={},r=null;this.getImagePath=function(){return t.imagePath};for(var o=0;o<t.cutouts.length;o++)e(t.cutouts[o]);this.select=function(i,r){if(r){var o=i+"*",u=s[o];if("undefined"==typeof u){u=[];for(var h=i.length,a=0;a<t.cutouts.length;a++){var _=t.cutouts[a],c=_._name||_.name;c&&c.substring(0,h)==i&&u.push(t.cutouts[a])}s[o]=u}if(!u.length)throw"Cutouts not found: '"+t.name+":"+i+"'";for(var a=0;a<u.length;a++)u[a]=n(u[a]);return u}var o=i+"?",f=s[o];if("undefined"==typeof f){for(var a=0;a<t.cutouts.length;a++){var _=t.cutouts[a],c=_._name||_.name;if(c==i){f=_;break}}!f&&t.factory&&(f=e(t.factory(i))),s[o]=f}if(!f)throw"Cutout not found: '"+t.name+":"+i+"'";return n(f)}},Cut.Texture._list={},Cut.Texture.add=function(){for(var t=0;t<arguments.length;t++){var i=arguments[t];Cut.Texture._list[i.name]=new Cut.Texture(i)}return this},Cut.addTexture=function(){return Cut.Texture.add.apply(Cut.Texture,arguments)},Cut.Out=function(t,i,e){return this.isCutout=!0,"function"==typeof i?this._imagefn=i:this._image=i,this._ratio=e||1,this._name=t.name,this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height,this._top=t.top||0,this._bottom=t.bottom||0,this._left=t.left||0,this._right=t.right||0,this._reset(),this},Cut.Out.prototype._reset=function(){this._sx=this._x*this._ratio,this._sy=this._y*this._ratio,this._sw=this._width*this._ratio,this._sh=this._height*this._ratio,this._dx=0,this._dy=0,this._dw=this._width,this._dh=this._height},Cut.Out.prototype.clone=function(){var t=Cut._create(Cut.Out.prototype);for(var i in this)this.hasOwnProperty(i)&&(t[i]=this[i]);return t._reset(),t},Cut.Out.prototype.dWidth=function(t){return"undefined"!=typeof t?(this._dw=t,this):this._dw},Cut.Out.prototype.dHeight=function(t){return"undefined"!=typeof t?(this._dh=t,this):this._dh},Cut.Out.prototype.cropX=function(t,i){return i=i||0,t=Math.min(t,this._width-i),this._dw=t,this._sw=t*this._ratio,this._sx=(this._x+i)*this._ratio,this},Cut.Out.prototype.cropY=function(t,i){return i=i||0,t=Math.min(t,this._height-i),this._dh=t,this._sh=t*this._ratio,this._sy=(this._y+i)*this._ratio,this},Cut.Out.prototype.offset=function(t,i){return this._dx=t,this._dy=i,this},Cut.Out.prototype.paste=function(t){Cut._stats.paste++,!this._image&&this._imagefn&&(this._image=this._imagefn());try{this._image&&t.drawImage(this._image,this._sx,this._sy,this._sw,this._sh,this._dx,this._dy,this._dw,this._dh)}catch(i){this._failed||(console.log("Unable to paste: "+this,img),this._failed=!0)}},Cut.Out.prototype.toString=function(){return"["+this._name+": "+this._sx+"x"+this._sy+"-"+this._sw+"x"+this._sh+this._dx+"x"+this._dy+"-"+this._dw+"x"+this._dh+"]"},Cut.Out.select=function(t,i){if("function"==typeof t)return Cut.Out.select(t());if("string"!=typeof t)return t;var e=t.indexOf(":");if(0>e)throw"Invalid selector: '"+t+"'";var n=[t.slice(0,e),t.slice(e+1)],s=Cut.Texture._list[n[0]];if(null==s)throw"Texture not found: '"+t+"'";return s.select(n[1],i)},Cut.drawing=function(){return Cut.image(Cut.Out.drawing.apply(Cut.Out,arguments))},Cut.Out.drawing=function(){var t=document.createElement("canvas"),i=t.getContext("2d"),e={},n=0;"object"==typeof arguments[n]?e=arguments[n++]:("string"==typeof arguments[n]&&(e.name=arguments[n++]),e.width=arguments[n++],e.height=arguments[n++],"number"==typeof arguments[n]&&(e.ratio=arguments[n++]),e.x=0,e.y=0),e.ratio=e.ratio||1,e.name=e.name||1e3*Math.random()|0,t.width=Math.ceil(e.width*e.ratio),t.height=Math.ceil(e.height*e.ratio);var s=new Cut.Out(e,t,e.ratio);return"function"==typeof arguments[arguments.length-1]&&arguments[arguments.length-1].call(s,i,e.ratio),s},Cut.Pin=function(t){this._owner=t,this._parent=null,this._relativeMatrix=new Cut.Matrix,this._absoluteMatrix=new Cut.Matrix,this.reset()},Cut.Pin.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._rotation=0,this._pivoted=!1,this._pivotX=null,this._pivotY=null,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height,this._ts_translate=Cut._TS++,this._ts_transform=Cut._TS++,this._ts_matrix=Cut._TS++},Cut.Pin.prototype.tick=function(){return this._parent=this._owner._parent&&this._owner._parent._pin,this._handled&&this._mo_handle!=this._ts_transform&&(this._mo_handle=this._ts_transform,this._ts_translate=Cut._TS++),this._aligned&&this._parent&&this._mo_align!=this._parent._ts_transform&&(this._mo_align=this._parent._ts_transform,this._ts_translate=Cut._TS++),this},Cut.Pin.prototype.toString=function(){return this._owner.id()+" ["+this._alignX+", "+this._alignY+"] ["+this._handleX+", "+this._handleY+"] ["+(this._parent?this._parent._owner.id():null)+"]"},Cut.Pin.prototype.absoluteMatrix=function(){var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_matrix:0);if(this._mo_abs==t)return this._absoluteMatrix;this._mo_abs=t;var i=this._absoluteMatrix;return i.copyFrom(this.relativeMatrix()),this._parent&&i.concat(this._parent._absoluteMatrix),this._ts_matrix=Cut._TS++,i},Cut.Pin.prototype.relativeMatrix=function(){var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_transform:0);if(this._mo_rel==t)return this._relativeMatrix;this._mo_rel=t;var i=this._relativeMatrix;if(i.identity(),this._pivoted&&i.translate(-this._pivotX*this._width,-this._pivotY*this._height),i.scale(this._scaleX,this._scaleY),i.skew(this._skewX,this._skewY),i.rotate(this._rotation),this._pivoted&&i.translate(this._pivotX*this._width,this._pivotY*this._height),this._pivoted)this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height;else{var e,n,s=i;s.a>0&&s.c>0||s.a<0&&s.c<0?(e=0,n=s.a*this._width+s.c*this._height):(e=s.a*this._width,n=s.c*this._height),e>n?(this._boxX=n,this._boxWidth=e-n):(this._boxX=e,this._boxWidth=n-e),s.b>0&&s.d>0||s.b<0&&s.d<0?(e=0,n=s.b*this._width+s.d*this._height):(e=s.b*this._width,n=s.d*this._height),e>n?(this._boxY=n,this._boxHeight=e-n):(this._boxY=e,this._boxHeight=n-e)}return this._x=this._offsetX,this._y=this._offsetY,this._x-=this._boxX+this._handleX*this._boxWidth,this._y-=this._boxY+this._handleY*this._boxHeight,this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),i.translate(this._x,this._y),this._relativeMatrix},Cut.Pin._SINGLE={},Cut.Pin.prototype.get=function(t){return Cut.Pin._getters[t]?Cut.Pin._getters[t](this):void 0},Cut.Pin.prototype.set=function(t,i){var e=Cut.Pin._SINGLE,n=null;for(n in e)delete e[n];if("string"==typeof t)e[t]=i;else if("object"==typeof t)for(n in t)e[n]=t[n];for(n in e)"undefined"!=typeof e[n]&&Cut.Pin._setters[n]&&Cut.Pin._setters[n](this,e[n],e);return this._owner&&(this._owner._ts_pin=Cut._TS++,this._owner.touch()),this},Cut.Pin._getters={alpha:function(t){return t._alpha},textureAlpha:function(t){return t._textureAlpha},width:function(t){return t._width},height:function(t){return t._height},scaleX:function(t){return t._scaleX},scaleY:function(t){return t._scaleY},skewX:function(t){return t._skewX},skewY:function(t){return t._skewY},rotation:function(t){return t._rotation},pivotX:function(t){return t._pivotX},pivotY:function(t){return t._pivotY},offsetX:function(t){return t._offsetX},offsetY:function(t){return t._offsetY},alignX:function(t){return t._alignX},alignY:function(t){return t._alignY},handleX:function(t){return t._handleX},handleY:function(t){return t._handleY}},Cut.Pin._setters={alpha:function(t,i){t._alpha=i},textureAlpha:function(t,i){t._textureAlpha=i},width:function(t,i){t._width_=i,t._width=i,t._ts_transform=Cut._TS++},height:function(t,i){t._height_=i,t._height=i,t._ts_transform=Cut._TS++},scale:function(t,i){t._scaleX=i,t._scaleY=i,t._ts_transform=Cut._TS++},scaleX:function(t,i){t._scaleX=i,t._ts_transform=Cut._TS++},scaleY:function(t,i){t._scaleY=i,t._ts_transform=Cut._TS++},skew:function(t,i){t._skewX=i,t._skewY=i,t._ts_transform=Cut._TS++},skewX:function(t,i){t._skewX=i,t._ts_transform=Cut._TS++},skewY:function(t,i){t._skewY=i,t._ts_transform=Cut._TS++},rotation:function(t,i){t._rotation=i,t._ts_transform=Cut._TS++},pivot:function(t,i){t._pivotX=i,t._pivotY=i,t._pivoted=!0,t._ts_transform=Cut._TS++},pivotX:function(t,i){t._pivotX=i,t._pivoted=!0,t._ts_transform=Cut._TS++},pivotY:function(t,i){t._pivotY=i,t._pivoted=!0,t._ts_transform=Cut._TS++},offset:function(t,i){t._offsetX=i,t._offsetY=i,t._ts_translate=Cut._TS++},offsetX:function(t,i){t._offsetX=i,t._ts_translate=Cut._TS++},offsetY:function(t,i){t._offsetY=i,t._ts_translate=Cut._TS++},align:function(t,i,e){this.alignX(t,i,e),this.alignY(t,i,e)},alignX:function(t,i,e){t._alignX=i,t._aligned=!0,t._ts_translate=Cut._TS++,this.handleX(t,i,e)},alignY:function(t,i,e){t._alignY=i,t._aligned=!0,t._ts_translate=Cut._TS++,this.handleY(t,i,e)},handle:function(t,i,e){this.handleX(t,i,e),this.handleY(t,i,e)},handleX:function(t,i){t._handleX=i,t._handled=!0,t._ts_translate=Cut._TS++},handleY:function(t,i){t._handleY=i,t._handled=!0,t._ts_translate=Cut._TS++},resizeMode:function(t,i,e){Cut._isNum(e.resizeWidth)&&Cut._isNum(e.resizeHeight)&&(this.resizeWidth(t,e.resizeWidth,e,!0),this.resizeHeight(t,e.resizeHeight,e,!0),"out"==i?t._scaleX=t._scaleY=Math.max(t._scaleX,t._scaleY):"in"==i&&(t._scaleX=t._scaleY=Math.min(t._scaleX,t._scaleY)),t._width=e.resizeWidth/t._scaleX,t._height=e.resizeHeight/t._scaleY)},resizeWidth:function(t,i,e,n){(!e.resizeMode||n)&&(t._scaleX=i/t._width_,t._width=t._width_,t._ts_transform=Cut._TS++)},resizeHeight:function(t,i,e,n){(!e.resizeMode||n)&&(t._scaleY=i/t._height_,t._height=t._height_,t._ts_transform=Cut._TS++)},scaleMode:function(t,i,e){Cut._isNum(e.scaleWidth)&&Cut._isNum(e.scaleHeight)&&(this.scaleWidth(t,e.scaleWidth,e,!0),this.scaleHeight(t,e.scaleHeight,e,!0),"out"==i?t._scaleX=t._scaleY=Math.max(t._scaleX,t._scaleY):"in"==i&&(t._scaleX=t._scaleY=Math.min(t._scaleX,t._scaleY)))},scaleWidth:function(t,i,e,n){(!e.scaleMode||n)&&(t._scaleX=i/t._width_,t._ts_transform=Cut._TS++)},scaleHeight:function(t,i,e,n){(!e.scaleMode||n)&&(t._scaleY=i/t._height_,t._ts_transform=Cut._TS++)},matrix:function(t,i,e){this.scaleX(t,i.a,e),this.skewX(t,i.c/i.d,e),this.skewY(t,i.b/i.a,e),this.scaleY(t,i.d,e),this.offsetX(t,i.e,e),this.offsetY(t,i.f,e),this.rotation(t,0,e)}},Cut.Matrix=function(t,i,e,n,s,r){this.changed=!0,this.a=t||1,this.b=i||0,this.c=e||0,this.d=n||1,this.e=s||0,this.f=r||0},Cut.Matrix.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f+"]"},Cut.Matrix.prototype.clone=function(){return new Cut.Matrix(this.a,this.b,this.c,this.d,this.e,this.f)},Cut.Matrix.prototype.copyTo=function(t){return t.copyFrom(this),this},Cut.Matrix.prototype.copyFrom=function(t){return this.changed=!0,this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this},Cut.Matrix.prototype.identity=function(){return this.changed=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},Cut.Matrix.prototype.rotate=function(t){if(!t)return this;this.changed=!0;var i=t?Math.cos(t):1,e=t?Math.sin(t):0,n=i*this.a-e*this.b,s=i*this.b+e*this.a,r=i*this.c-e*this.d,o=i*this.d+e*this.c,u=i*this.e-e*this.f,h=i*this.f+e*this.e;return this.a=n,this.b=s,this.c=r,this.d=o,this.e=u,this.f=h,this},Cut.Matrix.prototype.translate=function(t,i){return t||i?(this.changed=!0,this.e+=t,this.f+=i,this):this},Cut.Matrix.prototype.scale=function(t,i){return t-1||i-1?(this.changed=!0,this.a*=t,this.b*=i,this.c*=t,this.d*=i,this.e*=t,this.f*=i,this):this},Cut.Matrix.prototype.skew=function(t,i){if(!t&&!i)return this;this.changed=!0;
var e=this.a+this.b*t,n=this.b+this.a*i,s=this.c+this.d*t,r=this.d+this.c*i,o=this.e+this.f*t,u=this.f+this.e*i;return this.a=e,this.b=n,this.c=s,this.d=r,this.e=o,this.f=u,this},Cut.Matrix.prototype.concat=function(t){this.changed=!0;var i=this,e=i.a*t.a+i.b*t.c,n=i.b*t.d+i.a*t.b,s=i.c*t.a+i.d*t.c,r=i.d*t.d+i.c*t.b,o=i.e*t.a+t.e+i.f*t.c,u=i.f*t.d+t.f+i.e*t.b;return this.a=e,this.b=n,this.c=s,this.d=r,this.e=o,this.f=u,this},Cut.Matrix.prototype.reverse=function(){if(this.changed){this.changed=!1,this.reversed=this.reversed||new Cut.Matrix;var t=this.a*this.d-this.b*this.c;this.reversed.a=this.d/t,this.reversed.b=-this.b/t,this.reversed.c=-this.c/t,this.reversed.d=this.a/t,this.reversed.e=(this.c*this.f-this.e*this.d)/t,this.reversed.f=(this.e*this.b-this.a*this.f)/t}return this.reversed},Cut.Matrix.prototype.map=function(t,i){return i=i||{},i.x=this.a*t.x+this.c*t.y+this.e,i.y=this.b*t.x+this.d*t.y+this.f,i},Cut.Matrix.prototype.mapX=function(t,i){return this.a*t+this.c*i+this.e},Cut.Matrix.prototype.mapY=function(t,i){return this.b*t+this.d*i+this.f},Cut.Math={},Cut.Math.random=function(t,i){return 0==arguments.length?(i=1,t=0):1==arguments.length&&(i=t,t=0),t==i?t:Math.random()*(i-t)+t},Cut.Math.rotate=function(t,i,e){return arguments.length<3&&(e=i||0,i=0),e>i?(t=(t-i)%(e-i),t+(0>t?e:i)):(t=(t-e)%(i-e),t+(0>=t?i:e))},Cut.Math.length=function(t,i){return Math.sqrt(t*t+i*i)},Cut._TS=0,Cut._isCut=function(t){return t instanceof Cut},Cut._isNum=function(t){return"number"==typeof t},Cut._isFunc=function(t){return"function"==typeof t},Cut._isArray="isArray"in Array?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},Cut._extend=function(t,i,e){if(e)for(var n=0;n<e.length;n++){var s=e[n];t[s]=i[s]}else for(var s in i)t[s]=i[s];return t},Cut._now="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:Date.now?function(){return Date.now()}:function(){return+new Date},Cut._function=function(t){return"function"==typeof t?t:function(){return t}},Cut._options=function(t){return t.get=function(t){return"function"==typeof this[t]?this[t]():this[t]},t.extend=function(t){t="object"==typeof t?t:{};for(var i in this)t[i]=i in t?t[i]:this[i];return t},t.mixin=function(t){if("object"==typeof t)for(var i in t)this[i]=t[i];return this},t},Cut._status=function(t){if(!Cut._statusbox){var i=Cut._statusbox=document.createElement("div");i.style.position="absolute",i.style.color="black",i.style.background="white",i.style.zIndex=999,i.style.top="5px",i.style.right="5px",i.style.padding="1px 5px",document.body.appendChild(i)}Cut._statusbox.innerHTML=t},Cut.Easing=function(){function t(t){return t}function i(i){if("function"==typeof i)return i;if("string"!=typeof i)return t;var s=/^(\w+)(-(in|out|in-out|out-in))?(\((.*)\))?$/i.exec(i);if(!s||!s.length)return t;var r=s[1]||"",o=s[3]||"in",u=s[5];o=n[o],u=u?u.replace(/\s+/,"").split(","):[];var h=e[r],a=h?h.fn||h.fc.apply(h.fc,u):t;return o?o(a):a}var e={},n={};return i.addMode=function(t){for(var i=t.name.split(/\s+/),e=0;e<i.length;e++)i[e]&&(n[i[e]]=t.fn)},i.add=function(t){for(var i=t.name.split(/\s+/),n=0;n<i.length;n++)i[n]&&(e[i[n]]=t)},i}(),Cut.Easing.addMode({name:"in",fn:function(t){return function(i){return t(i)}}}),Cut.Easing.addMode({name:"out",fn:function(t){return function(i){return 1-t(1-i)}}}),Cut.Easing.addMode({name:"in-out",fn:function(t){return function(i){return.5>i?t(2*i)/2:1-t(2*(1-i))/2}}}),Cut.Easing.addMode({name:"out-in",fn:function(t){return function(i){return.5>i?1-t(2*(1-i))/2:t(2*i)/2}}}),Cut.Easing.add({name:"linear",fn:function(t){return t}}),Cut.Easing.add({name:"quad",fn:function(t){return t*t}}),Cut.Easing.add({name:"cubic",fn:function(t){return t*t*t}}),Cut.Easing.add({name:"quart",fn:function(t){return t*t*t*t}}),Cut.Easing.add({name:"quint",fn:function(t){return t*t*t*t*t}}),Cut.Easing.add({name:"sin sine",fn:function(t){return 1-Math.cos(t*Math.PI/2)}}),Cut.Easing.add({name:"exp",fn:function(t){return 0==t?0:Math.pow(2,10*(t-1))}}),Cut.Easing.add({name:"circle circ",fn:function(t){return 1-Math.sqrt(1-t*t)}}),Cut.Easing.add({name:"bounce",fn:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}}),Cut.Easing.add({name:"poly",fc:function(t){return function(i){return Math.pow(i,t)}}}),Cut.Easing.add({name:"elastic",fc:function(t,i){i=i||.45,t=t||1;var e=i/(2*Math.PI)*Math.asin(1/t);return function(n){return 1+t*Math.pow(2,-10*n)*Math.sin(2*(n-e)*Math.PI/i)}}}),Cut.Easing.add({name:"back",fc:function(t){return t=arguments.length?t:1.70158,function(i){return i*i*((t+1)*i-t)}}}),"undefined"!=typeof module&&(module.exports=Cut),"undefined"==typeof Cut&&"function"==typeof require&&(Cut=require("./cut-core")),DEBUG=("undefined"==typeof DEBUG||DEBUG)&&console,window.addEventListener("load",function(){DEBUG&&console.log("On load."),Cut.Loader.start()},!1),Cut.Loader.init=function(t,i){function e(){r?(o=window.innerWidth>0?window.innerWidth:screen.width,u=window.innerHeight>0?window.innerHeight:screen.height,n.style.width=o+"px",n.style.height=u+"px"):(o=n.clientWidth,u=n.clientHeight),o*=h,u*=h,n.width=o,n.height=u,DEBUG&&console.log("Resize: "+o+" x "+u+" / "+h),p.resize(o,u,h)}i=i||{};var n=i.canvas,s=null,r=!1,o=0,u=0,h=1;if("string"==typeof n&&(n=document.getElementById(n)),n||(n=document.getElementById("cutjs")),!n){r=!0,DEBUG&&console.log("Creating element..."),n=document.createElement("canvas"),n.style.position="absolute";var a=document.body;a.insertBefore(n,a.firstChild)}s=n.getContext("2d");var _=window.devicePixelRatio||1,c=s.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1;h=_/c;var f=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};DEBUG&&console.log("Creating root...");var p=Cut.root(f,function(){s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,o,u),this.render(s)});return t(p,n),e(),window.addEventListener("resize",e,!1),p},Cut.Loader.loadImage=function(t,i,e){var n=new Image;return DEBUG&&console.log("Loading image: "+t),n.onload=i,n.onerror=e,n.src=t,n},"undefined"==typeof Cut&&"function"==typeof require&&(Cut=require("./cut-core")),DEBUG=("undefined"==typeof DEBUG||DEBUG)&&console,Cut.Mouse=function(){Cut.Mouse.subscribe.apply(Cut.Mouse,arguments)},Cut.Mouse.CLICK="click",Cut.Mouse.START="touchstart mousedown",Cut.Mouse.MOVE="touchmove mousemove",Cut.Mouse.END="touchend mouseup",Cut.Mouse.subscribe=function(t,i,e){function n(t,n){h(t,i),DEBUG&&console.log("Mouse Start: "+t.type+" "+_),!e&&i.addEventListener(n,r),t.preventDefault(),u(t.type,t),f.x=_.x,f.y=_.y,f.state=1}function s(t,n){try{DEBUG&&console.log("Mouse End: "+t.type+" "+_),!e&&i.removeEventListener(n,r),t.preventDefault(),u(t.type,t),1==f.state&&f.x==_.x&&f.y==_.y?(DEBUG&&console.log("Mouse Click [+]"),u("click",t),f.state=2):f.state=0}catch(s){console&&console.log(s)}}function r(t){try{h(t,i),t.preventDefault(),u(t.type,t)}catch(e){console&&console.log(e)}}function o(t){try{h(t,i),DEBUG&&console.log("Mouse Click: "+t.type+" "+_),t.preventDefault(),2!=f.state?u(t.type,t):DEBUG&&console.log("Mouse Click [-]")}catch(e){console&&console.log(e)}}function u(i,e){_.type=i,_.event=e,c.x=_.x,c.y=_.y,t.visit(a)}function h(i,e){var n=!1;if(i.touches){if(!i.touches.length)return;n=!0,_.x=i.touches[0].pageX,_.y=i.touches[0].pageY}else _.x=i.clientX,_.y=i.clientY,document.body.scrollLeft||document.body.scrollTop||document.documentElement&&(_.x+=document.documentElement.scrollLeft,_.y+=document.documentElement.scrollTop);_.x-=e.clientLeft||0,_.y-=e.clientTop||0;for(var s=e;s;)_.x-=s.offsetLeft||0,_.y-=s.offsetTop||0,n||(_.x+=s.scrollLeft||0,_.y+=s.scrollTop||0),s=s.offsetParent;_.x*=t._ratio||1,_.y*=t._ratio||1}i=i||document,i.addEventListener("click",o),"ontouchstart"in window?(i.addEventListener("touchstart",function(t){n(t,"touchmove")}),i.addEventListener("touchend",function(t){s(t,"touchmove")}),e&&i.addEventListener("touchmove",r)):(i.addEventListener("mousedown",function(t){n(t,"mousemove")}),i.addEventListener("mouseup",function(t){s(t,"mousemove")}),e&&i.addEventListener("mousemove",r));var a=null,_={x:0,y:0,toString:function(){return(0|this.x)+"x"+(0|this.y)}},c={x:0,y:0,toString:function(){return _+" / "+(0|this.x)+"x"+(0|this.y)}},f={x:0,y:0,state:0};a={reverse:!0,visible:!0,start:function(t){return t._listens(_.type)?void 0:!0},end:function(i){var e=i.listeners(_.type);if(e){if(i.matrix().reverse().map(_,c),i===t||i.attr("spy"));else if(c.x<0||c.x>i._pin._width||c.y<0||c.y>i._pin._height)return;c.raw=_.event;for(var n=0;n<e.length;n++)if(e[n].call(i,c))return!0}}}},"function"==typeof define&&define.amd&&define("Cut",[],function(){return Cut});